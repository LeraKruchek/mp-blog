!function(){angular.module("admin-app",["admin-app.controllers","admin-app.directives"])}(),function(){angular.module("blog-app",["ui.router","admin-app","blog-app.directives","blog-app.controllers"]).config(["$locationProvider","$stateProvider","$urlRouterProvider",function(a,b,c){a.html5Mode(!0),c.otherwise("/"),b.state("anon",{"abstract":!0,template:"<ui-view/>"}).state("anon.firstPost",{url:"/",controller:"FirstPostController",controllerAs:"FirstPostController",templateUrl:"/public/dist/templates/first-post.html"}).state("anon.post",{url:"/articles/:id",controller:"PostController",controllerAs:"PostCtrl",templateUrl:"/public/dist/templates/single-post.html"}).state("anon.login",{url:"/login",controller:"LoginController",controllerAs:"LoginCtrl",templateUrl:"/public/dist/templates/login-page.html"}),b.state("admin",{"abstract":!0,controller:"",template:"<ui-view/>",data:{auth:!0}}).state("admin.archive",{controller:"AdminController",controllerAs:"AdminCtrl",url:"/admin",templateUrl:"/public/dist/templates/admin/admin-home.html"}).state("admin.new",{url:"/admin/new",controller:"NewPostController",controllerAs:"NewPostCtrl",templateUrl:"/public/dist/templates/admin/admin-new.html"}).state("admin.edit",{url:"/admin/edit/:id",controller:"AdminController",template:"<p>edit</p>"})}]).run(["$rootScope","$state","AuthService",function(a,b,c){a.$on("$stateChangeStart",function(a,d){if(d.data){var e=c.getInfo();e||(a.preventDefault(),b.go("anon.login"))}})}])}(),function(){function a(a,b){var c=this;c.req={},c.login=function(){c.req.name=c.name,c.req.password=c.password,a.login(c.req).then(function(){c.req={},b.go("admin.archive")})}}function b(a){var b=this;b.posts=[],a.getPosts().then(function(a){b.posts=a}),b.deletePost=function(c,d){a.deletePost(c).then(function(){b.posts.splice(d,1)})}}function c(){var a=this;a.newPost={},a.newPost.text="hi",a.newPost.date=new Date}angular.module("admin-app.controllers",["admin-app.services"]).controller("AdminController",b).controller("LoginController",a).controller("NewPostController",c),a.$inject=["AuthService","$state"],b.$inject=["AdminPostFactory","$scope"],c.$inject=["$scope"]}(),function(){function a(a,b){var c=this;c.posts=[],b.getPosts().then(function(a){c.posts=a})}function b(a,b,c,d){var e=this,f=c.id;console.log(d.path()),console.log(d.search()),e.posts=[],b.getPosts().then(function(a){e.posts=a,e.currentPost=e.posts.filter(function(a){return a.visible_id===f}),e.currentPost=e.currentPost[0],e.nextPost=e.posts[e.posts.indexOf(e.currentPost)+1],e.previousPost=e.posts[e.posts.indexOf(e.currentPost)-1]})}angular.module("blog-app.controllers",["blog-app.services","blog-app.filters"]).controller("FirstPostController",a).controller("PostController",b),a.$inject=["$scope","PostFactory"],b.$inject=["$scope","PostFactory","$stateParams","$location"]}(),function(){function a(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){function e(){var a=b.html();c.stripBr&&"<br>"==a&&(a=""),d.$setViewValue(a)}d&&(d.$render=function(){b.html(d.$viewValue||"")},b.on("blur keyup change",function(){a.$evalAsync(e)}),e())}}}angular.module("admin-app.directives",[]).directive("ngContenteditable",a)}(),function(){function a(){return{restrict:"A",scope:{ngBackImage:"@"},link:function(a,b,c){c.$observe("ngBackImage",function(a){b.css({"background-image":"url("+a+")","background-size":"cover"})})}}}function b(){return{restrict:"E",replace:!0,templateUrl:"/public/dist/templates/partials/nav-primary.html"}}angular.module("blog-app.directives",[]).directive("ngBackImage",a).directive("navPrimary",b)}(),function(){function a(){return function(a){var b=["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"],c=new Date(a);return"1970"==c.getFullYear()?"Черновик":c.getDate()+" "+b[c.getMonth()]+", "+c.getFullYear()}}function b(a){return function(b){return a.trustAsHtml(b)}}angular.module("blog-app.filters",[]).filter("rusDate",a).filter("sanitize",b),b.$inject=["$sce"]}(),function(){function a(a,b,c){function d(){c.sessionStorage.userInfo&&(e.userInfo=JSON.parse(c.sessionStorage.userInfo))}var e={};return e.login=function(d){var f=b.defer();return a.post("/api/login",d).success(function(a){e.userInfo={accessToken:a.access_token,userName:a.userName},c.sessionStorage.userInfo=JSON.stringify(e.userInfo),f.resolve(a)}).error(function(a){f.reject(a),console.log(a)}),f.promise},e.logout=function(){e.userInfo=null,c.sessionStorage.userInfo=null},e.getInfo=function(){return e.userInfo},d(),e}function b(a,b,c){var d={},e=c.getInfo();return a.defaults.headers.get={access_token:e.accessToken},a.defaults.headers["delete"]={access_token:e.accessToken},d.getPosts=function(){var c=b.defer();return a.get("api/admin/posts").success(function(a){c.resolve(a)}).error(function(){c.reject()}),c.promise},d.deletePost=function(c){var d=b.defer();return a["delete"]("api/admin/delete/"+c).success(function(a){d.resolve(a)}).error(function(){d.reject()}),d.promise},d}angular.module("admin-app.services",[]).factory("AuthService",a).factory("AdminPostFactory",b),a.$inject=["$http","$q","$window"],b.$inject=["$http","$q","AuthService"]}(),function(){function a(a,b){var c={};return c.getPosts=function(){var c=b.defer();return a.get("/api/anon/posts").success(function(a){c.resolve(a)}).error(function(){console.log("error")}),c.promise},c}angular.module("blog-app.services",[]).factory("PostFactory",a),a.$inject=["$http","$q"]}();