function ngReallyClick(a){var b=function(a,b){a.ok=function(){b.close()},a.cancel=function(){b.dismiss("cancel")}};return{restrict:"A",scope:{ngReallyClick:"&"},link:function(c,d,e){d.bind("click",function(){var d=e.message,f=e.title||"",g='<div class="modal-body">'+d+"</br><p>"+f+"</p></div>";g+='<div class="modal-footer"><button class="btn-result btn-ok" ng-click="ok()">OK</button><button class="btn-result btn-cnl" ng-click="cancel()">Cancel</button></div>';var h=a.open({template:g,controller:b});h.result.then(function(){c.ngReallyClick(),c.$emit("modal.closed")},function(){})})}}}!function(){angular.module("blog-app",["ui.router","admin-app","confirm-app","blog-app.directives","blog-app.controllers","blog-app.filters","blog-app.services"]).config(["$locationProvider","$stateProvider","$urlRouterProvider",function(a,b,c){a.html5Mode(!0),c.otherwise("/"),b.state("anon",{"abstract":!0,template:"<ui-view/>"}).state("anon.firstPost",{url:"/",controller:"FirstPostController",controllerAs:"FirstPostController",templateUrl:"/public/dist/templates/anon/first-post.html"}).state("anon.post",{url:"/articles/:id",controller:"PostController",controllerAs:"PostCtrl",templateUrl:"/public/dist/templates/anon/single-post.html"}).state("anon.login",{url:"/login",controller:"LoginController",controllerAs:"LoginCtrl",templateUrl:"/public/dist/templates/anon/login-page.html"}).state("anon.archive",{url:"/archive",controller:"ArchiveController",controllerAs:"ArchiveCtrl",templateUrl:"/public/dist/templates/anon/archive-page.html"}).state("anon.info",{url:"/about",controller:"InfoController",controllerAs:"InfoCtrl",templateUrl:"/public/dist/templates/anon/info-page.html"}),b.state("admin",{"abstract":!0,controller:"",template:"<ui-view/>",data:{auth:!0}}).state("admin.archive",{controller:"AdminController",controllerAs:"AdminCtrl",url:"/admin/archive",templateUrl:"/public/dist/templates/admin/admin-archive.html"}).state("admin.new",{url:"/admin/new",controller:"NewPostController",controllerAs:"NewPostCtrl",templateUrl:"/public/dist/templates/admin/admin-new.html"}).state("admin.edit",{url:"/admin/edit/:visible_id",controller:"EditPostController",controllerAs:"EditPostCtrl",templateUrl:"/public/dist/templates/admin/admin-edit.html"}).state("admin.edit-info",{url:"/admin/info",controller:"EditInfoController",controllerAs:"EditInfoCtrl",templateUrl:"public/dist/templates/admin/admin-edit-info.html"})}]).run(["$rootScope","$state","AuthService","$anchorScroll",function(a,b,c,d){a.$on("$stateChangeStart",function(a,e){d();var f=c.getInfo();"anon.login"===e.name&&f&&(a.preventDefault(),b.go("admin.archive")),e.data&&(f||(a.preventDefault(),b.go("anon.login")))})}])}(),function(){angular.module("admin-app.controllers",[])}(),function(){function a(a){var b=this;b.posts=[],a.getPosts().then(function(a){b.posts=a}),b.deletePost=function(c,d){a.deletePost(c).then(function(){b.posts.splice(d,1)})}}angular.module("admin-app.controllers").controller("AdminController",a),a.$inject=["AdminPostFactory","$scope"]}(),function(){function a(a){var b=this;b.info={},b.info.output="",a.getInfo().then(function(a){b.info=a[0]}),b.saveInfo=function(){a.saveInfo(b.info).then(function(a){console.log(a)})}}angular.module("admin-app.controllers").controller("EditInfoController",a),a.$inject=["AdminInfoFactory"]}(),function(){function a(a,b,c,d,e){var f=this,g=b.visible_id;e.$on("modal.closed",function(){c.go("admin.archive")}),a.getPost(g).then(function(a){f.post=a[0],f.post.output=f.decodeEntities(f.post.output),f.state="visible"===f.post.state?!1:!0}),f.decodeEntities=function(a){return a.replace(/&amp;/g,"&").replace(/&#\d+;/g,function(a){var b=a.match(/\d+/g);return String.fromCharCode(b[0])})},f.savePost=function(){f.post.output=d(f.post.output),f.state?f.post.state="hidden":("draft"===f.post.state&&(f.post.date=new Date),f.post.state="visible"),a.savePost(f.post._id,f.post).then(function(){})}}angular.module("admin-app.controllers").controller("EditPostController",a),a.$inject=["AdminPostFactory","$stateParams","$state","$sanitize","$scope"]}(),function(){function a(a,b){var c=this;c.req={},c.login=function(){c.req.name=c.name,c.req.password=c.password,a.login(c.req).then(function(){c.req={},b.go("admin.archive")})},c.logout=function(){a.logout(),b.go("anon.login")}}angular.module("admin-app.controllers").controller("LoginController",a),a.$inject=["AuthService","$state"]}(),function(){function a(a,b,c,d){var e=this;e.newPost={},e.newPost.date="",e.newPost.output="",d.$on("modal.closed",function(){b.go("admin.archive")}),e.addPost=function(){e.newPost.output=c(e.newPost.output),e.newPost.state?e.newPost.state="draft":(e.newPost.state="visible",e.newPost.date=new Date),a.addPost(e.newPost).then(function(){e.newPost={}})}}angular.module("admin-app.controllers").controller("NewPostController",a),a.$inject=["AdminPostFactory","$state","$sanitize","$scope"]}(),function(){angular.module("blog-app.controllers",[])}(),function(){function a(a){var b=this;b.posts=[],a.getPosts().then(function(a){b.posts=a})}angular.module("blog-app.controllers").controller("ArchiveController",a),a.$inject=["PostFactory"]}(),function(){function a(a,b){var c=this;c.posts=[],b.getPosts().then(function(a){c.posts=a})}angular.module("blog-app.controllers").controller("FirstPostController",a),a.$inject=["$scope","PostFactory"]}(),function(){function a(a){var b=this;a.getInfo().then(function(a){b.info=a[0].output})}angular.module("blog-app.controllers").controller("InfoController",a),a.$inject=["InfoFactory"]}(),function(){function a(a,b,c){var d=this,e=c.id;d.posts=[],b.getPosts().then(function(a){d.posts=a,d.currentPost=d.posts.filter(function(a){return a.visible_id===e}),d.currentPost=d.currentPost[0],d.nextPost=d.posts[d.posts.indexOf(d.currentPost)-1],d.previousPost=d.posts[d.posts.indexOf(d.currentPost)+1]})}angular.module("blog-app.controllers").controller("PostController",a),a.$inject=["$scope","PostFactory","$stateParams","$location"]}(),function(){function a(){return{restrict:"A",scope:{output:"=",ngAddTag:"@"},link:function(a,b){b.bind("click",function(){var b="",c=document.getElementsByClassName("contenteditable"),d=c[0].value,e=c[0].selectionStart;switch(a.ngAddTag){case"p":b+="<p></p>";break;case"img":b+='<img src="">';break;case"figcaption":b+="<figcaption></figcaption>";break;case"a":b+='<a href=""></a>'}a.output=d.slice(0,e)+b+d.slice(e,d.length)})}}}angular.module("admin-app.directives",[]).directive("ngAddTag",a),a.$inject=["$sce"]}(),function(){function a(){return{restrict:"A",scope:{ngBackImageOverlay:"@"},link:function(a,b,c){c.$observe("ngBackImageOverlay",function(a){b.css({"background-image":"linear-gradient(rgba(46, 48, 57, 0.75), rgba(46, 48, 57, 0.75)),url("+a+")","background-size":"cover"})})}}}function b(){return{restrict:"A",scope:{ngBackImage:"@"},link:function(a,b,c){c.$observe("ngBackImage",function(a){b.css({"background-image":"url("+a+")","background-size":"cover"})})}}}function c(){return{restrict:"E",replace:!0,template:'<a ui-sref="anon.firstPost"><img class="logo" src="/public/dist/images/logo.png"></a>'}}angular.module("blog-app.directives",[]).directive("ngBackImage",b).directive("ngBackImageOverlay",a).directive("goHome",c)}(),function(){function a(){return function(a){return a&&a.length?a.replace(/\n/g,""):void 0}}angular.module("admin-app.filters",[]).filter("deleteCR",a)}(),function(){function a(){return function(a){if(!a||!a.length)return"Черновик";var b=["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"],c=new Date(a);return"1970"==c.getFullYear()?"Черновик":c.getDate()+" "+b[c.getMonth()]+", "+c.getFullYear()}}function b(a){return function(b){return b&&b.length?a.trustAsHtml(b):void 0}}angular.module("blog-app.filters",[]).filter("rusDate",a).filter("unsafe",b),b.$inject=["$sce"]}(),function(){angular.module("admin-app",["admin-app.controllers","admin-app.directives","admin-app.services","admin-app.filters","confirm-app","ngSanitize"])}(),angular.module("confirm-app",["ui.bootstrap"]).directive("ngReallyClick",ngReallyClick),ngReallyClick.$inject=["$modal"],function(){function a(a,b,c){function d(){c.sessionStorage.userInfo&&(e.userInfo=JSON.parse(c.sessionStorage.userInfo))}var e={};return e.login=function(d){var f=b.defer();return a.post("/api/login",d).success(function(a){e.userInfo={accessToken:a.access_token,userName:a.userName},c.sessionStorage.userInfo=JSON.stringify(e.userInfo),f.resolve(a)}).error(function(a){f.reject(a),console.log(a)}),f.promise},e.logout=function(){e.userInfo=null,c.sessionStorage.userInfo=null},e.getInfo=function(){return e.userInfo},d(),e}function b(a,b,c){var d={},e=c.getInfo();return a.defaults.headers.get={access_token:e.accessToken},a.defaults.headers["delete"]={access_token:e.accessToken},a.defaults.headers.post={access_token:e.accessToken},a.defaults.headers.put={access_token:e.accessToken},a.defaults.headers.post["Content-Type"]="application/json",a.defaults.headers.put["Content-Type"]="application/json",d.getPosts=function(){var c=b.defer();return a.get("api/admin/posts").success(function(a){c.resolve(a)}).error(function(){c.reject()}),c.promise},d.getPost=function(c){var d=b.defer();return a.get("api/admin/post/"+c).success(function(a){d.resolve(a)}).error(function(a){d.reject(a)}),d.promise},d.deletePost=function(c){var d=b.defer();return a["delete"]("api/admin/delete/"+c).success(function(a){d.resolve(a)}).error(function(){d.reject()}),d.promise},d.addPost=function(c){var d=b.defer();return a.post("api/admin/posts",c).success(function(a){d.resolve(a)}).error(function(){d.reject()}),d.promise},d.savePost=function(c,d){var e=b.defer();return a.put("api/admin/post/"+c,d).success(function(a){e.resolve(a)}).error(function(){e.reject()}),e.promise},d}function c(a,b,c){var d={},e=c.getInfo();return a.defaults.headers.get={access_token:e.accessToken},a.defaults.headers.put={access_token:e.accessToken},a.defaults.headers.get["Content-Type"]="application/json",a.defaults.headers.put["Content-Type"]="application/json",d.getInfo=function(){var c=b.defer();return a.get("/api/admin/info").success(function(a){c.resolve(a)}).error(function(){c.reject()}),c.promise},d.saveInfo=function(c){var d=b.defer();return a.put("/api/admin/info",c).success(function(a){d.resolve(a)}).error(function(){d.reject()}),d.promise},d}angular.module("admin-app.services",[]).factory("AuthService",a).factory("AdminPostFactory",b).factory("AdminInfoFactory",c),a.$inject=["$http","$q","$window"],b.$inject=["$http","$q","AuthService"],c.$inject=["$http","$q","AuthService"]}(),function(){function a(a,b){var c={};return c.getPosts=function(){var c=b.defer();return a.get("/api/anon/posts").success(function(a){c.resolve(a)}).error(function(){console.log("error")}),c.promise},c}function b(a,b){var c={};return c.getInfo=function(){var c=a.defer();return b.get("/api/anon/info").success(function(a){c.resolve(a)}).error(function(){c.reject()}),c.promise},c}angular.module("blog-app.services",[]).factory("PostFactory",a).factory("InfoFactory",b),a.$inject=["$http","$q"],b.$inject=["$q","$http"]}();